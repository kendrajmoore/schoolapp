
var Q = require('q');

console.log(do {
	var x =<< doDeferred('X');

	console.log("Got X");

	var	y =<< doDeferred('Y');

	console.log("Got Y");

	console.log('Done');

	return "Value";
});



var Nothing = {
	then: function () {
		return Nothing;
	}
}
function some(x) {
	return {
		then: function (f) {
			var v = f(x);
			return v === Nothing ? v : some(v);
		}
	}
}


console.log(do {
	var x =<< some(10);
	console.log("Something?");
} === Nothing);


function doDeferred(n) {
	var d = Q.defer();
	setTimeout(() => {
		console.log('Done: ' + n);
		d.resolve()
	}, 1000);
	return d.promise;
}
